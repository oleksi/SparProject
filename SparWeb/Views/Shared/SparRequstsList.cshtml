@model IList<SparWeb.Models.ConfirmSparDetailsViewModel>

<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-9">
		<h2>Upcoming Spars:</h2>
	</div>
	<div class="col-md-2"></div>
</div>
<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-9 upcomingSpars">
		@if (Model.Count > 0 && Model.Any(sr => sr.SparRequesStatus == SparModel.SparRequestStatus.Confirmed || sr.SparRequesStatus == SparModel.SparRequestStatus.DateLocationNegotiation) == true)
		{
			foreach (SparWeb.Models.ConfirmSparDetailsViewModel currSparRequest in Model)
			{
				if (currSparRequest.SparRequesStatus == SparModel.SparRequestStatus.Confirmed || currSparRequest.SparRequesStatus == SparModel.SparRequestStatus.DateLocationNegotiation)
				{
					<div data-saprrequestid="@currSparRequest.SparRequestId">
						<div class="row well well-sm spar-fighter">
							<div class="col-md-3 vAlignCenter">
								<div class="title hidden-md hidden-lg hidden-sm">
									<span class="fighterNameSmall">@currSparRequest.OpponentFighter.Name</span>
									<div class="row">
										<div class="col-md-12">
											from <span class="gymNameSmall">@((currSparRequest.OpponentFighter.Gym != null) ? currSparRequest.OpponentFighter.Gym.Name : "Unknown Gym")</span>
											<br />
											@currSparRequest.OpponentFighter.City, @currSparRequest.OpponentFighter.State
										</div>
									</div>
								</div>
								<div>
									<img height="@currSparRequest.ProfilePictureSize" src="@Util.GetProfilePictureFile(currSparRequest.OpponentFighter, currSparRequest.ProfilePictureSize)" class="img-responsive" />
								</div>
							</div>
							<div class="col-md-6 hidden-xs vAlignCenter">
								<span class="fighterNameSmall hidden-xs">@currSparRequest.OpponentFighter.Name</span>
								<div class="row hidden-xs">
									<div class="col-md-12 hidden-xs">
										from <span class="gymNameSmall hidden-xs">@((currSparRequest.OpponentFighter.Gym != null) ? currSparRequest.OpponentFighter.Gym.Name : "Unknown Gym")</span>
										<br />
										@currSparRequest.OpponentFighter.City, @currSparRequest.OpponentFighter.State
									</div>
								</div>
								<br class="hidden-xs" />
								@{ Html.RenderPartial("SparInformation", currSparRequest); }
							</div>
							@if (currSparRequest.SparRequesStatus == SparModel.SparRequestStatus.Confirmed)
							{
								<div class="col-md-3 col-lg-2 col-xs-12 left-space vAlignCenter">
									<input type="button" value="Cancel Spar" class="btn btn-default btn-danger btn-lg col-xs-12 col-sm-12" onclick="confirmCancelSpar('@currSparRequest.OpponentFighter.Name', '@currSparRequest.SparRequestId');" />
								</div>
							}
							else if (currSparRequest.SparRequesStatus == SparModel.SparRequestStatus.DateLocationNegotiation)
							{
								<div class="col-md-2 vAlignCenter">
									<small>A spar negotiation is in progress</small>
									<br />
									@Html.ActionLink("View Details", "SparDetailsConfirmation", "Spar", new System.Web.Routing.RouteValueDictionary() { { "ID", currSparRequest.SparRequestId } }, null)
								</div>
							}
						</div>
					</div>
				}
			}
		}
		else
		{
			<p>You have no spars scheduled at this time</p>
		}
	</div>
	<div class="col-md-2"></div>
</div>
<div id="confirmCancelSparyModal" class="modal fade">
	<input type="hidden" name="cancelSparRequestId" id="cancelSparRequestId" />
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Cancel Spar Confirmation</h4>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to cancel spar with <span></span> </p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" onclick="doCancelSpar();" class="btn btn-primary">Cancel Spar</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	function confirmCancelSpar(opponentFighterName, sparRequestId) {
		$('#confirmCancelSparyModal').find('p').find('span').text(opponentFighterName);
		$('#cancelSparRequestId').val(sparRequestId);
		$('#confirmCancelSparyModal').modal('show');
	}

	function doCancelSpar() {
		$.ajax({
			type: "POST",
			url: '@Url.Action("CancelSpar", "Spar")',
			data: { sparRequestId: $('#cancelSparRequestId').val() },
			success: function (data) {
				$('.upcomingSpars').find('.container[data-saprRequestId="' + $('#cancelSparRequestId').val() + '"]').remove();
				$('#cancelSparRequestId').val('');
				$('#confirmCancelSparyModal').modal('hide');
				location.reload(true);
			}
		});
	}
</script>
